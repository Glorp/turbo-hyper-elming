<html>

<head>
  <title>Ting</title>
  <script src="resources/elm-runtime.js"></script>
  <script src="build/Graphecs.js"></script>
  <script src="build/Ting.js"></script>
</head>

<body/>

<script type="text/javascript">
  var ting = Elm.fullscreen(Elm.Ting, {inn: null});

    function thingety(req) {
        if (!req) {
            ting.ports.inn.send(null);
            return;
        }
        console.log(req);
        ting.ports.inn.send([req, null]);

        var xhr = new XMLHttpRequest();
        xhr.open(req.verb, req.url, true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.setRequestHeader("Content-length", req.body.length);
        xhr.setRequestHeader("accept", "application/vnd.siren+json");
        xhr.onload = function(){
            ting.ports.inn.send([req,
                                 {body: xhr.responseText,
                                  status: xhr.status,
                                  statusText: xhr.statusText,
                                  headers : xhr.getAllResponseHeaders()}]);
        }
        xhr.send(req.body);
    }

    ting.ports.out.subscribe(thingety);
</script>
</html>
